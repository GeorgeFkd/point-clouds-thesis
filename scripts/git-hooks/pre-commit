#!/bin/bash

#generated by claude code

# Pre-commit hook to check and auto-format changed C/C++ files
# Place this file in .git/hooks/pre-commit and make it executable

# Get list of staged C/C++ files
FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(c|cpp|cc|cxx|h|hpp|hxx)$')

if [ -z "$FILES" ]; then
    # No C/C++ files staged, exit successfully
    exit 0
fi

# Check if clang-format is installed
if ! command -v clang-format &> /dev/null; then
    echo "âŒ Error: clang-format is not installed."
    echo "Please install it before committing."
    echo ""
    echo "On Ubuntu/Debian: sudo apt install clang-format"
    echo "On macOS: brew install clang-format"
    exit 1
fi

echo "ðŸ” Checking formatting for staged files..."

# Check and format each file
FORMATTED_FILES=""
for FILE in $FILES; do
    # Check if file needs formatting
    clang-format --dry-run --Werror "$FILE" 2>&1 > /dev/null
    if [ $? -ne 0 ]; then
        echo "   Formatting: $FILE"
        # Format the file in place
        clang-format -i "$FILE"
        # Re-stage the formatted file
        git add "$FILE"
        FORMATTED_FILES="$FORMATTED_FILES $FILE"
    fi
done

# Print summary
if [ -n "$FORMATTED_FILES" ]; then
    echo ""
    echo "âœ… Auto-formatted and re-staged the following files:"
    for FILE in $FORMATTED_FILES; do
        echo "   - $FILE"
    done
    echo ""
    echo "Files have been formatted and added to your commit."
else
    echo "âœ… All staged files are properly formatted!"
fi

exit 0
